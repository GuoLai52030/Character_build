<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>è¡€æœˆç”Ÿå­˜æ¨¡æ‹Ÿå™¨</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: sans-serif; background: #1a1a1a; color: #eee; padding: 20px; }
        .panel { background: #2a2a2a; padding: 20px; border-radius: 15px; max-width: 800px; margin: 0 auto; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        .stat-card { background: #333; padding: 15px; border-radius: 10px; border-left: 5px solid #ff5252; }
        .safe { border-left-color: #4caf50 !important; color: #4caf50; }
        .danger { border-left-color: #ff5252 !important; color: #ff5252; }
        input[type=range] { width: 100%; margin: 10px 0; }
        label { font-size: 0.9em; color: #bbb; }
        .value { font-weight: bold; color: #fff; float: right; }
    </style>
</head>
<body>

<div class="panel">
    <h2>ğŸŒ™ è¡€æœˆç”Ÿå­˜æ•°å€¼æ¨¡æ‹Ÿ</h2>
    
    <div class="grid">
        <div>
            <label>è¡€æœˆç­‰çº§ (L): <span class="value" id="lText">0</span></label>
            <input type="range" id="lSlider" min="0" max="300" value="0">
            
            <label>æ€ªç‰©æ•°é‡ (N): <span class="value" id="nText">1</span></label>
            <input type="range" id="nSlider" min="1" max="50" value="1">
            
            <label>ç©å®¶æ”»å‡»åŠ› (ATK): <span class="value" id="atkText">122</span></label>
            <input type="range" id="atkSlider" min="100" max="50000" value="122">
        </div>

        <div id="statusCard" class="stat-card danger">
            <div style="font-size: 0.9em;">ç”Ÿå­˜çŠ¶æ€é¢„æµ‹:</div>
            <div id="statusText" style="font-size: 1.4em; font-weight: bold; margin: 5px 0;">æåº¦å±é™©</div>
            <div style="font-size: 0.85em; opacity: 0.8;">
                å»ºè®®æœ€å°æ”»å‡»åŠ›: <span id="suggestAtk">0</span>
            </div>
        </div>
    </div>

    <canvas id="mainChart" height="150"></canvas>
</div>

<script>
    const lSlider = document.getElementById('lSlider');
    const nSlider = document.getElementById('nSlider');
    const atkSlider = document.getElementById('atkSlider');
    const ctx = document.getElementById('mainChart').getContext('2d');

    function getMonsterHP(L) {
        if (L <= 100) return 3703 + 24.57 * L;
        if (L <= 200) return 6160 + 262.68 * (L - 100);
        return 32428 + 383.48 * (L - 200);
    }

    const chart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: Array.from({length: 61}, (_, i) => i * 5),
            datasets: [{
                label: 'å½“å‰å‹åŠ›ç‚¹',
                data: [],
                pointRadius: 10,
                backgroundColor: '#ff5252'
            }, {
                label: 'æ€ªç‰©æ€»è¡€é‡æ›²çº¿',
                data: Array.from({length: 61}, (_, i) => getMonsterHP(i * 5)),
                borderColor: '#555',
                borderWidth: 1,
                pointRadius: 0
            }]
        },
        options: {
            scales: { y: { display: false }, x: { grid: { display: false } } },
            plugins: { legend: { display: false } }
        }
    });

    function update() {
        const L = parseInt(lSlider.value);
        const N = parseInt(nSlider.value);
        const ATK = parseInt(atkSlider.value);
        const HP = getMonsterHP(L);
        const totalHP = HP * N;

        // æ ¸å¿ƒé€»è¾‘è®¡ç®—
        // ç©å®¶å­˜æ´»æ—¶é—´ = 100 / (N * 30)
        // ç©å®¶æ€æ€ªæ‰€éœ€æ”»å‡»åŠ› = æ€ªç‰©æ€»è¡€é‡ / ç©å®¶å­˜æ´»æ—¶é—´
        const playerLifeTime = 100 / (N * 30);
        const minRequiredAtk = Math.ceil(totalHP / playerLifeTime);
        const isSafe = ATK >= minRequiredAtk;

        // æ›´æ–° UI
        document.getElementById('lText').innerText = L;
        document.getElementById('nText').innerText = N;
        document.getElementById('atkText').innerText = ATK;
        document.getElementById('suggestAtk').innerText = minRequiredAtk.toLocaleString();
        
        const card = document.getElementById('statusCard');
        const stText = document.getElementById('statusText');
        if (isSafe) {
            card.className = "stat-card safe";
            stText.innerText = "å¯ä»¥å­˜æ´» âœ…";
        } else {
            card.className = "stat-card danger";
            stText.innerText = "æ— æ³•ç”Ÿå­˜ âŒ";
        }

        // æ›´æ–°å›¾è¡¨
        chart.data.datasets[0].data = [{x: L/5, y: HP}]; // ç®€åŒ–æ˜¾ç¤ºé€»è¾‘
        chart.update('none');
    }

    [lSlider, nSlider, atkSlider].forEach(s => s.addEventListener('input', update));
    update();
</script>
</body>
</html>

