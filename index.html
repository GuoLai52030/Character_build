<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>数值膨胀与生存预测</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --primary: #00e5ff; --danger: #ff5252; --bg: #121212; --card: #1e1e1e; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); color: #fff; padding: 20px; margin: 0; }
        .container { max-width: 950px; margin: 0 auto; background: var(--card); padding: 25px; border-radius: 16px; border: 1px solid #333; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .grid { display: grid; grid-template-columns: 350px 1fr; gap: 25px; }
        .panel { background: #252525; padding: 20px; border-radius: 12px; }
        .stat-card { background: #000; padding: 15px; border-radius: 8px; border-left: 4px solid var(--primary); margin-bottom: 10px; }
        input[type=range] { width: 100%; margin: 10px 0; accent-color: var(--primary); }
        .value { float: right; color: var(--primary); font-family: monospace; font-weight: bold; }
        .status-badge { display: block; padding: 10px; text-align: center; border-radius: 6px; font-weight: bold; margin-top: 15px; }
        .safe { background: #1b4332; color: #74c69d; border: 1px solid #2d6a4f; }
        .death { background: #431b1b; color: #ff8787; border: 1px solid #6a2d2d; }
        canvas { margin-top: 20px; max-height: 300px; }
    </style>
</head>
<body>

<div class="container">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
        <h2 style="margin:0;">⚔️ 数值膨胀模拟器 <small style="font-size:0.5em; color:#888;">(累加模型)</small></h2>
        <div id="statusBadge" class="status-badge death">计算中...</div>
    </div>

    <div class="grid">
        <div class="panel">
            <label>血月等级 (L): <span id="lVal" class="value">0</span></label>
            <input type="range" id="lSlider" min="0" max="300" value="0">

            <label>怪物数量 (N): <span id="nVal" class="value">1</span></label>
            <input type="range" id="nSlider" min="1" max="50" value="1">

            <label>词缀增伤累计: <span id="bVal" class="value">0%</span></label>
            <input type="range" id="bSlider" min="0" max="800" value="0" step="10">

            <div style="margin-top:20px; font-size:0.85em; color:#aaa;">
                <div style="margin-bottom:5px;">固定常数：</div>
                • 局外基础伤害: 30<br>
                • 局内初始伤害: 122<br>
                • 玩家血量: 100 | 怪物攻击: 30
            </div>
        </div>

        <div class="panel">
            <div class="stat-card">
                <div style="font-size:0.8em; color:#888;">局内攻击力 (ATK_in)</div>
                <div id="atkIn" style="font-size:1.4em;">122</div>
            </div>
            <div class="stat-card" style="border-left-color: #ff9f43;">
                <div style="font-size:0.8em; color:#888;">暴击伤害 (Crit_Dmg)</div>
                <div id="critDmg" style="font-size:1.4em;">214</div>
            </div>
            <div class="stat-card" style="border-left-color: #ee5253;">
                <div style="font-size:0.8em; color:#888;">生存倒计时 (T_die)</div>
                <div id="tDie" style="font-size:1.4em;">3.33s</div>
            </div>
            
            <div style="padding:10px; font-size:0.9em; color:#888;">
                建议清场总输出需达到: <span id="reqDmg" style="color:#fff;">0</span>
            </div>
        </div>
    </div>

    <canvas id="mainChart"></canvas>
</div>

<script>
    const lS = document.getElementById('lSlider');
    const nS = document.getElementById('nSlider');
    const bS = document.getElementById('bSlider');
    const ctx = document.getElementById('mainChart').getContext('2d');

    function getHP(L) {
        if (L <= 100) return 3703 + 24.57 * L;
        if (L <= 200) return 6160 + 262.68 * (L - 100);
        return 32428 + 383.48 * (L - 200);
    }

    const chart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: Array.from({length: 31}, (_, i) => i * 10),
            datasets: [{
                label: '所需清场攻击力',
                data: [],
                borderColor: '#444',
                borderWidth: 1,
                pointRadius: 0,
                fill: false
            }, {
                label: '你的攻击力',
                data: [],
                borderColor: '#00e5ff',
                backgroundColor: 'rgba(0, 229, 255, 0.2)',
                fill: true,
                pointRadius: 0
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: { type: 'logarithmic', grid: { color: '#333' } },
                x: { grid: { display: false } }
            },
            plugins: { legend: { display: false } }
        }
    });

    function update() {
        const L = parseInt(lS.value);
        const N = parseInt(nS.value);
        const bonus = parseInt(bS.value) / 100;
        
        // --- 核心计算 ---
        const atkOut = 30;
        const atkInit = 122;
        // 局内攻击力 = 局外 + (初始 - 局外) * (1 + 增伤)
        const atkIn = atkOut + (atkInit - atkOut) * (1 + bonus);
        // 暴击伤害 = 2 * 局内 - 局外
        const crit = 2 * atkIn - atkOut;
        
        const mHP = getHP(L);
        const totalMHP = mHP * N;
        const timeDie = 100 / (N * 30);
        
        // 判定：单位时间内的输出是否能清掉总血量
        const isSafe = atkIn >= (totalMHP / timeDie);

        // --- 更新 UI ---
        document.getElementById('lVal').innerText = L;
        document.getElementById('nVal').innerText = N;
        document.getElementById('bVal').innerText = (bonus * 100) + "%";
        document.getElementById('atkIn').innerText = Math.floor(atkIn).toLocaleString();
        document.getElementById('critDmg').innerText = Math.floor(crit).toLocaleString();
        document.getElementById('tDie').innerText = timeDie.toFixed(2) + "s";
        document.getElementById('reqDmg').innerText = Math.ceil(totalMHP).toLocaleString();

        const badge = document.getElementById('statusBadge');
        if(isSafe) {
            badge.innerText = "数值压制：成功存活";
            badge.className = "status-badge safe";
        } else {
            badge.innerText = "数值崩坏：无法生存";
            badge.className = "status-badge death";
        }

        // --- 更新图表 ---
        const myAtkData = Array(31).fill(atkIn);
        const reqAtkData = Array.from({length: 31}, (_, i) => (getHP(i * 10) * N) / timeDie);
        
        chart.data.datasets[0].data = reqAtkData;
        chart.data.datasets[1].data = myAtkData;
        chart.update('none');
    }

    [lS, nS, bS].forEach(el => el.addEventListener('input', update));
    update();
</script>

</body>
</html>
